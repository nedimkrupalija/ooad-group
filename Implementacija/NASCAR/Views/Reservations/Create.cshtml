@model NASCAR.Models.Reservation


@{
    ViewData["Title"] = "Rent";

    var veh = ViewData["VehicleId"];
    string? priceDay = ViewData["Price"].ToString();
}

<h1></h1>

<h4>Reservation</h4>
<hr />
<body>
    <div class="row">
        <div class="col-md-4">
            <form asp-action="Create">
                <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                <div class="form-group">
                    <label asp-for="PickUpDate" class="control-label"></label>
                    <input asp-for="PickUpDate" class="form-control" />
                    <input value="@ViewData["VehicleId"]" asp-for="VehicleId" class="form-control invisible" readonly id="vehicle_id" />
                    <input value="1" asp-for="DiscountId" class="form-control invisible" readonly id="discount" />
                    <span class="text-danger" id="date-from-validate"></span>
                    <br />
                </div>
                <div class="form-group">
                    <label asp-for="DropDate" class="control-label"></label>
                    <input asp-for="DropDate" class="form-control"  />
                    <span class="text-danger" id="date-to-validate"></span>
                    <br />
                </div>
                
                <div class="form-group">
                    <label asp-for="PaymentType" class="control-label"></label>
                    <select asp-for="PaymentType" class="form-control" asp-items="ViewBag.PaymentType"></select>
                    <span asp-validation-for="PaymentType" class="text-danger"></span>
                    <br />
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label asp-for="Price" class="form-label mt-4">Total price in BAM</label>
                        <p></p>
                        <input class="visible form-control" asp-for="Price" placeholder="@ViewData["Price"] per day" id="price" readonly style="width: 150px;" />
                    </div>
                    <br />
                    <div class="form-group">
                        <input name="reservate" onclick="popup()" type="submit" value="Reservate" class="btn btn-primary" disabled />
                    </div>
                </div>
                    <input value=@veh asp-for="VehicleId" class="form-control invisible" placeholder="@ViewData["VehicleId"]" readonly="" id="vehicle_id" />
                    <input value="1" asp-for="DiscountId" class="form-control invisible" id="discount" placeholder="%" readonly="" />               
            </form>
        </div>
    </div>
<div>
    <a asp-controller="Home" asp-action="Index" class="mt-2 btn btn-outline-danger">Cancel</a>
</div>

<script>
        const price = document.getElementById("price");
        var start = document.getElementsByName("PickUpDate")[0];
        var end = document.getElementsByName("DropDate")[0];
        start.addEventListener('change', calcDiff);
        end.addEventListener('change', calcDiff);
        var button = document.getElementsByName("reservate")[0];
        var fromValidate = document.getElementById("date-from-validate");
        var toValidate = document.getElementById("date-to-validate");

    function popup() {
        alert("Your reservation is successfully taken!");
    }

    function calcDiff() {
        var startDate = new Date(start.value);
        var endDate = new Date(end.value);
        const currentDate = new Date();
        var diff = endDate.getTime() - startDate.getTime();
        var days = diff / (1000 * 3600 * 24);

        if (start.value === "" || end.value === "") {
            price.value = "";
            button.disabled = true;
            return;
        }

        if (startDate < currentDate) {
            fromValidate.textContent = "Please select a valid date.";
            button.disabled = true;
        } else {
            fromValidate.textContent = "";
            button.disabled = false;
        }

        if (endDate < currentDate) {
            toValidate.textContent = "Please select a valid date.";
            button.disabled = true;
        } else {
            toValidate.textContent = "";
            button.disabled = false;
        }

        if (endDate < startDate) {
            price.value = "";
            button.disabled = true;
            return;
        }

            if (days > 0 && days <= 7) {
                document.getElementById("discount").value = "5";
                var pricePerDay = parseFloat("@ViewData["Price"]");
                var totalPrice = pricePerDay * days;
                price.value = totalPrice.toFixed(2);
            } else if (days > 7 && days <= 14) {
                document.getElementById("discount").value = "10";
                var pricePerDay = parseFloat("@ViewData["Price"]");
                var totalPrice = pricePerDay * days;
                price.value = totalPrice.toFixed(2);
            } else if (days > 14 && days <= 30) {
                document.getElementById("discount").value = "15";
                var pricePerDay = parseFloat("@ViewData["Price"]");
                var totalPrice = pricePerDay * days;
                price.value = totalPrice.toFixed(2);
            } else if (days > 30) {
                document.getElementById("discount").value = "20";
                var pricePerDay = parseFloat("@ViewData["Price"]");
                var totalPrice = pricePerDay * days;
                price.value = totalPrice.toFixed(2);
            }
        }
    </script>





    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"></script>
    
</body>
